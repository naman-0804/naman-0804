name: Todoist Readme

on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 */2 * *"

jobs:
  update-readme:
    name: Update Todoist stats
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - id: todoist
        uses: abhisheknaiidu/todoist-readme@master
        with:
          TODOIST_API_KEY: ${{ secrets.TODOIST_API_KEY }}
          PREMIUM: ""

      - name: Construct HTML Table
        run: |
          # Fetch values from the output of the todoist action
          KARMA_POINTS=$(echo "${{ steps.todoist.outputs.karma_points }}" | tr -d '\r')
          COMPLETED_TODAY=$(echo "${{ steps.todoist.outputs.completed_today }}" | tr -d '\r')
          COMPLETED_TOTAL=$(echo "${{ steps.todoist.outputs.completed }}" | tr -d '\r')
          LONGEST_STREAK=$(echo "${{ steps.todoist.outputs.longest_streak }}" | tr -d '\r')

          # Construct the HTML table
          echo '<table>' > README.md
          echo '    <tr>' >> README.md
          echo '        <th style="border: 2px solid #4CAF50; padding: 10px; background-color: #f2f2f2;">Task Summary</th>' >> README.md
          echo '    </tr>' >> README.md
          echo '    <tr>' >> README.md
          echo '        <td style="border: 2px solid #4CAF50; padding: 10px;">üèÜ Karma Points</td>' >> README.md
          echo "        <td style=\"border: 2px solid #4CAF50; padding: 10px;\">${KARMA_POINTS}</td>" >> README.md
          echo '    </tr>' >> README.md
          echo '    <tr>' >> README.md
          echo '        <td style="border: 2px solid #4CAF50; padding: 10px;">üå∏ Completed Tasks Today</td>' >> README.md
          echo "        <td style=\"border: 2px solid #4CAF50; padding: 10px;\">${COMPLETED_TODAY}</td>" >> README.md
          echo '    </tr>' >> README.md
          echo '    <tr>' >> README.md
          echo '        <td style="border: 2px solid #4CAF50; padding: 10px;">‚úÖ Completed Tasks So Far</td>' >> README.md
          echo "        <td style=\"border: 2px solid #4CAF50; padding: 10px;\">${COMPLETED_TOTAL}</td>" >> README.md
          echo '    </tr>' >> README.md
          echo '    <tr>' >> README.md
          echo '        <td style="border: 2px solid #4CAF50; padding: 10px;">‚è≥ Longest Streak</td>' >> README.md
          echo "        <td style=\"border: 2px solid #4CAF50; padding: 10px;\">${LONGEST_STREAK}</td>" >> README.md
          echo '    </tr>' >> README.md
          echo '</table>' >> README.md

      - name: Commit and push changes
        run: |
          git config --local user.email "you@example.com"
          git config --local user.name "Your Name"
          git add README.md
          git commit -m "Update README with Todoist stats"
          git push
